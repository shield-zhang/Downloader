

# 软件测试

## 一.第一阶段

### 1.单元测试

单元测试是白盒测试，要尽可能覆盖所测试单元的路径。

根据设计，需要对四个类进行单元测试。

单元测试代码如下：

#### IfLegalTest

```java
class IfLegalTest {

    @BeforeEach
    void setUp() {

    }

    @Test
    void ifLegalURL() {
        Assertions.assertEquals(IfLegal.ifLegalURL(""),false);
        Assertions.assertEquals(IfLegal.ifLegalURL(null),false);
        Assertions.assertEquals(IfLegal.ifLegalURL("wwwwwa"),false);
        Assertions.assertEquals(IfLegal.ifLegalURL("https://down5.huorong.cn/sysdiag-full-5.0.65.2-2022.2.10.1.exe"),true);
    }

    @Test
    void ifLegalSavePath() {
        Assertions.assertEquals(IfLegal.ifLegalSavePath("E:\\save"),true);
        Assertions.assertEquals(IfLegal.ifLegalSavePath("wwwas"),false);
    }

    @Test
    void ifLegalThreadNum() {
        Assertions.assertEquals(IfLegal.ifLegalThreadNum(1),true);
    }
}
```

#### Http

```java
public class Http {
    /**
     * 获取每个分块的HttpURLConnection
     */
    public static HttpURLConnection getHttpURLConnection(String url,long beginSite,long endSite) throws IOException {
        HttpURLConnection httpURLConnection=getHttpURLConnection(url);
        if (endSite!=-1){
            httpURLConnection.setRequestProperty("RANGE","bytes="+beginSite+"-"+endSite);
        }else {
            httpURLConnection.setRequestProperty("RANGE","bytes="+beginSite+"-");
        }


        return httpURLConnection;
    }
    /**
     * 将下载链接转换为HttpURLConnection
     */
    public static HttpURLConnection getHttpURLConnection(String url1) throws IOException {
        URL url = new URL(url1);
        URLConnection urlConnection = url.openConnection();
        urlConnection.setRequestProperty("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_0) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11");
        return (HttpURLConnection) urlConnection;
    }

}
```
#### DownloadInfoTest

```java
class DownloadInfoTest {

    @Test
    void getFileName() {
        Assertions.assertEquals(DownloadInfo.getFileName("https://down5.huorong.cn/sysdiag-full-5.0.65.2-2022.2.10.1.exe","E:\\save"),"E:\\save\\sysdiag-full-5.0.65.2-2022.2.10.1.exe");
    }

    @Test
    void calculateEverySize() {
        DownloadInfo.calculateEverySize("https://down5.huorong.cn/sysdiag-full-5.0.65.2-2022.2.10.1.exe",8);

        Assertions.assertEquals(DownloadInfo.calculateEverySize("sdfaeqewwwqqqa",8),0);
    }

```

#### DownloadControlTest

```java
class DownloadControlTest {
    private DownloadControl downloadControl=new DownloadControl();
    @Test
    void run() {
        downloadControl.run("https://down5.huorong.cn/sysdiag-full-5.0.65.2-2022.2.10.1.exe","E:\\save",3);

        downloadControl.run("https://down5.huorong.cn/sysdiag-full-5.0.65.2-2022.2.10.1.xxxe","E:\\save",3);
    }
}
```

#### 测试单元运行结果

![image-20220210234742346](.\image\第一阶段\第一阶段单元测试1.png)

![image-20220210234936548](.\image\第一阶段\第一阶段单元测试2.png)

![image-20220210235025693](.\image\第一阶段\第一阶段单元测试3.png)

有一部分路径无法实现未覆盖，主要是catch异常代码。由于函数内部调用时经过会检测，有意识地避开异常，故这部分代码会被避免执行。

运行结果符合要求。

### 2.集成测试

采用等价类划分法

|    url       | savePath | threadNum |
| :------------ | :---- |:---- |
| 可以正常打开的url | 存在的路径   | 1~32的整数 |
|  不能打开的url   |  不存在的路径   | 除了1~32的整数之外的数|

#### 用例表

|    编号     |    url       | savePath | threadNum |
| :------------ | :---- |:---- |:---- |
| 1 | https://down5.huorong.cn/sysdiag-full-5.0.65.2-2022.2.10.1.exe | E:\save | 8 |
| 2 | https://baikevideo.cdn.bcebos.com/media/mda-Ogjg39gVColin1F7/509e1134865e62c445bcabbdc68007f0.mp4 | E:\save | 8 |
| 3 | https://baikevideo.cdn.bcebos.com/media/mda-Ogjg39gVColin1F7/509e1134865e62c445bcabbdc68007f0.mp4 | wsollllw | 8 |
| 4 | https://baikevideo.cdn.bcebos.com/media/mda-Ogjg39gVColin1F7/509e1134865e62c445bcabbdc68007f0.mp4 | E:\save | 0 |
| 5 | https://baikevideo.cdn.bcebos.com/media/mda-Ogjg39gVColin1F7/509e1134865e62c445bcabbdc68007f0.mp4 | E:\save | 40 |
| 6 | wwwwwwwwqq | E:\save | 8 |
| 7 | swwwwwwqwqwq | wefcdzddcds | 8 |
| 8 | https://baikevideo.cdn.bcebos.com/media/mda-Ogjg39gVColin1F7/509e1134865e62c445bcabbdc68007f0.mp4 | E:\不存在的文件夹 | 8 |
| 9 | https://c-ssl.duitang.com/uploads/item/202007/05/20200705220128_qaxlx.jpg | E:\save | 8 |
| 10 | https://c-ssl.duitang.com/uploads/item/202007/05/20200705220128_qaxlx.jpg | E:\save | 1         |

#### 测试结果:

##### 1号用例符合预期

![image-20220211002206142](.\image\第一阶段\第一阶段集成测试11.png)

![image-20220211002254115](.\image\第一阶段\第一阶段集成测试12.png)

##### 2号用例符合预期

![image-20220211002610917](.\image\第一阶段\第一阶段集成测试21.png)

![image-20220211002736967](.\image\第一阶段\第一阶段集成测试22.png)

##### 3号用例符合预期

![image-20220211002847253](.\image\第一阶段\第一阶段单元测试31.png)

##### 4号用例符合预期

![image-20220211003038689](.\image\第一阶段\第一阶段集成测试41.png)

##### 5号用例符合预期

![image-20220211003203155](.\image\第一阶段\第一阶段集成测试51.png)

##### 6号用例符合预期

![image-20220211003656016](.\image\第一阶段\第一阶段单元测试61.png)

##### 7号用例符合预期

![image-20220211003823807](.\image\第一阶段\第一阶段集成测试71.png)

##### 8号用例符合预期

![image-20220211004218032](.\image\第一阶段\第一阶段集成测试81.png)

##### 9号用例符合预期

![image-20220211004354732](.\image\第一阶段\第一阶段集成测试91.png)

##### 10号用例符合预期

##### ![image-20220211004529602](.\image\第一阶段\第一阶段集成测试101.png)